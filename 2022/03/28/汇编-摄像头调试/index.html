<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1, maximum-scale=2">
<meta name="theme-color" content="#222">
<meta name="generator" content="Hexo 6.0.0">
  <link rel="apple-touch-icon" sizes="180x180" href="/images/apple-touch-icon-next.png">
  <link rel="icon" type="image/png" sizes="32x32" href="/images/favicon-32x32-next.png">
  <link rel="icon" type="image/png" sizes="16x16" href="/images/favicon-16x16-next.png">
  <link rel="mask-icon" href="/images/logo.svg" color="#222">

<link rel="stylesheet" href="/css/main.css">


<link rel="stylesheet" href="/lib/font-awesome/css/all.min.css">

<script id="hexo-configurations">
    var NexT = window.NexT || {};
    var CONFIG = {"hostname":"example.com","root":"/","scheme":"Muse","version":"7.8.0","exturl":false,"sidebar":{"position":"left","display":"post","padding":18,"offset":12,"onmobile":false},"copycode":{"enable":false,"show_result":false,"style":null},"back2top":{"enable":true,"sidebar":false,"scrollpercent":false},"bookmark":{"enable":false,"color":"#222","save":"auto"},"fancybox":false,"mediumzoom":false,"lazyload":false,"pangu":false,"comments":{"style":"tabs","active":null,"storage":true,"lazyload":false,"nav":null},"algolia":{"hits":{"per_page":10},"labels":{"input_placeholder":"Search for Posts","hits_empty":"We didn't find any results for the search: ${query}","hits_stats":"${hits} results found in ${time} ms"}},"localsearch":{"enable":true,"trigger":"auto","top_n_per_article":1,"unescape":false,"preload":true},"motion":{"enable":true,"async":false,"transition":{"post_block":"fadeIn","post_header":"slideDownIn","post_body":"slideDownIn","coll_header":"slideLeftIn","sidebar":"slideUpIn"}},"path":"search.json"};
  </script>

  <meta name="description" content="基本配置1234192.168.1.108adminadmin123    网络配置改到同一网段  Javabean加载123456789101112@SpringBootApplicationpublic class DemoApplication &amp;#123;    public static void main(String[] args) &amp;#123;        SpringAppli">
<meta property="og:type" content="article">
<meta property="og:title" content="汇编-摄像头调试">
<meta property="og:url" content="http://example.com/2022/03/28/%E6%B1%87%E7%BC%96-%E6%91%84%E5%83%8F%E5%A4%B4%E8%B0%83%E8%AF%95/index.html">
<meta property="og:site_name" content="藏经阁">
<meta property="og:description" content="基本配置1234192.168.1.108adminadmin123    网络配置改到同一网段  Javabean加载123456789101112@SpringBootApplicationpublic class DemoApplication &amp;#123;    public static void main(String[] args) &amp;#123;        SpringAppli">
<meta property="og:locale" content="en_US">
<meta property="og:image" content="https://picgo-freejim.oss-cn-beijing.aliyuncs.com/to_upload/image-20220128155246789.png">
<meta property="og:image" content="https://picgo-freejim.oss-cn-beijing.aliyuncs.com/to_upload/image-20220129140058272.png">
<meta property="og:image" content="https://picgo-freejim.oss-cn-beijing.aliyuncs.com/to_upload/image-20220208153430162.png">
<meta property="og:image" content="https://picgo-freejim.oss-cn-beijing.aliyuncs.com/to_upload/image-20220128165158781.png">
<meta property="og:image" content="https://picgo-freejim.oss-cn-beijing.aliyuncs.com/to_upload/image-20220209163912533.png">
<meta property="og:image" content="https://picgo-freejim.oss-cn-beijing.aliyuncs.com/to_upload/image-20220210101319145.png">
<meta property="og:image" content="https://picgo-freejim.oss-cn-beijing.aliyuncs.com/to_upload/image-20220209104916940.png">
<meta property="og:image" content="https://picgo-freejim.oss-cn-beijing.aliyuncs.com/to_upload/image-20220209104945261.png">
<meta property="og:image" content="https://picgo-freejim.oss-cn-beijing.aliyuncs.com/to_upload/image-20220209105703676.png">
<meta property="og:image" content="https://picgo-freejim.oss-cn-beijing.aliyuncs.com/to_upload/image-20220209143014527.png">
<meta property="og:image" content="https://picgo-freejim.oss-cn-beijing.aliyuncs.com/to_upload/image-20220218101018839.png">
<meta property="og:image" content="https://picgo-freejim.oss-cn-beijing.aliyuncs.com/to_upload/image-20220215134809280.png">
<meta property="og:image" content="https://picgo-freejim.oss-cn-beijing.aliyuncs.com/to_upload/image-20220215135118485.png">
<meta property="og:image" content="https://picgo-freejim.oss-cn-beijing.aliyuncs.com/to_upload/image-20220215180045023.png">
<meta property="og:image" content="https://picgo-freejim.oss-cn-beijing.aliyuncs.com/to_upload/image-20220217104343024.png">
<meta property="og:image" content="https://picgo-freejim.oss-cn-beijing.aliyuncs.com/to_upload/image-20220217104631215.png">
<meta property="og:image" content="https://picgo-freejim.oss-cn-beijing.aliyuncs.com/to_upload/image-20220217104730660.png">
<meta property="og:image" content="https://picgo-freejim.oss-cn-beijing.aliyuncs.com/to_upload/image-20220217105010584.png">
<meta property="og:image" content="https://picgo-freejim.oss-cn-beijing.aliyuncs.com/to_upload/image-20220217105454207.png">
<meta property="og:image" content="https://picgo-freejim.oss-cn-beijing.aliyuncs.com/to_upload/image-20220208143559167.png">
<meta property="article:published_time" content="2022-03-28T04:58:28.000Z">
<meta property="article:modified_time" content="2022-06-27T07:46:17.479Z">
<meta property="article:author" content="FreeJim">
<meta property="article:tag" content="Java">
<meta name="twitter:card" content="summary">
<meta name="twitter:image" content="https://picgo-freejim.oss-cn-beijing.aliyuncs.com/to_upload/image-20220128155246789.png">

<link rel="canonical" href="http://example.com/2022/03/28/%E6%B1%87%E7%BC%96-%E6%91%84%E5%83%8F%E5%A4%B4%E8%B0%83%E8%AF%95/">


<script id="page-configurations">
  // https://hexo.io/docs/variables.html
  CONFIG.page = {
    sidebar: "",
    isHome : false,
    isPost : true,
    lang   : 'en'
  };
</script>

  <title>汇编-摄像头调试 | 藏经阁</title>
  






  <noscript>
  <style>
  .use-motion .brand,
  .use-motion .menu-item,
  .sidebar-inner,
  .use-motion .post-block,
  .use-motion .pagination,
  .use-motion .comments,
  .use-motion .post-header,
  .use-motion .post-body,
  .use-motion .collection-header { opacity: initial; }

  .use-motion .site-title,
  .use-motion .site-subtitle {
    opacity: initial;
    top: initial;
  }

  .use-motion .logo-line-before i { left: initial; }
  .use-motion .logo-line-after i { right: initial; }
  </style>
</noscript>

  <meta name="baidu-site-verification" content="code-ezgXxhziUq" />
</head>

<body itemscope itemtype="http://schema.org/WebPage">
  <div class="container use-motion">
    <div class="headband"></div>

    <header class="header" itemscope itemtype="http://schema.org/WPHeader">
      <div class="header-inner"><div class="site-brand-container">
  <div class="site-nav-toggle">
    <div class="toggle" aria-label="Toggle navigation bar">
      <span class="toggle-line toggle-line-first"></span>
      <span class="toggle-line toggle-line-middle"></span>
      <span class="toggle-line toggle-line-last"></span>
    </div>
  </div>

  <div class="site-meta">

    <a href="/" class="brand" rel="start">
      <span class="logo-line-before"><i></i></span>
      <h1 class="site-title">藏经阁</h1>
      <span class="logo-line-after"><i></i></span>
    </a>
  </div>

  <div class="site-nav-right">
    <div class="toggle popup-trigger">
        <i class="fa fa-search fa-fw fa-lg"></i>
    </div>
  </div>
</div>




<nav class="site-nav">
  <ul id="menu" class="main-menu menu">
        <li class="menu-item menu-item-home">

    <a href="/" rel="section"><i class="fa fa-home fa-fw"></i>Home</a>

  </li>
        <li class="menu-item menu-item-archives">

    <a href="/archives/" rel="section"><i class="fa fa-archive fa-fw"></i>Archives</a>

  </li>
      <li class="menu-item menu-item-search">
        <a role="button" class="popup-trigger"><i class="fa fa-search fa-fw"></i>Search
        </a>
      </li>
  </ul>
</nav>



  <div class="search-pop-overlay">
    <div class="popup search-popup">
        <div class="search-header">
  <span class="search-icon">
    <i class="fa fa-search"></i>
  </span>
  <div class="search-input-container">
    <input autocomplete="off" autocapitalize="off"
           placeholder="Searching..." spellcheck="false"
           type="search" class="search-input">
  </div>
  <span class="popup-btn-close">
    <i class="fa fa-times-circle"></i>
  </span>
</div>
<div id="search-result">
  <div id="no-result">
    <i class="fa fa-spinner fa-pulse fa-5x fa-fw"></i>
  </div>
</div>

    </div>
  </div>

</div>
    </header>

    
  <div class="back-to-top">
    <i class="fa fa-arrow-up"></i>
    <span>0%</span>
  </div>


    <main class="main">
      <div class="main-inner">
        <div class="content-wrap">
          

          <div class="content post posts-expand">
            

    
  
  
  <article itemscope itemtype="http://schema.org/Article" class="post-block" lang="en">
    <link itemprop="mainEntityOfPage" href="http://example.com/2022/03/28/%E6%B1%87%E7%BC%96-%E6%91%84%E5%83%8F%E5%A4%B4%E8%B0%83%E8%AF%95/">

    <span hidden itemprop="author" itemscope itemtype="http://schema.org/Person">
      <meta itemprop="image" content="/images/avatar.jpg">
      <meta itemprop="name" content="FreeJim">
      <meta itemprop="description" content="Hello World">
    </span>

    <span hidden itemprop="publisher" itemscope itemtype="http://schema.org/Organization">
      <meta itemprop="name" content="藏经阁">
    </span>
      <header class="post-header">
        <h1 class="post-title" itemprop="name headline">
          汇编-摄像头调试
        </h1>

        <div class="post-meta">
            <span class="post-meta-item">
              <span class="post-meta-item-icon">
                <i class="far fa-calendar"></i>
              </span>
              <span class="post-meta-item-text">Posted on</span>

              <time title="Created: 2022-03-28 12:58:28" itemprop="dateCreated datePublished" datetime="2022-03-28T12:58:28+08:00">2022-03-28</time>
            </span>
              <span class="post-meta-item">
                <span class="post-meta-item-icon">
                  <i class="far fa-calendar-check"></i>
                </span>
                <span class="post-meta-item-text">Edited on</span>
                <time title="Modified: 2022-06-27 15:46:17" itemprop="dateModified" datetime="2022-06-27T15:46:17+08:00">2022-06-27</time>
              </span>

          

        </div>
      </header>

    
    
    
    <div class="post-body" itemprop="articleBody">

      
        <h1 id="基本配置"><a href="#基本配置" class="headerlink" title="基本配置"></a>基本配置</h1><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line">192.168.1.108</span><br><span class="line"></span><br><span class="line">admin</span><br><span class="line">admin123</span><br></pre></td></tr></table></figure>



<h2 id="网络配置"><a href="#网络配置" class="headerlink" title="网络配置"></a>网络配置</h2><p>改到同一网段</p>
<p><img src="https://picgo-freejim.oss-cn-beijing.aliyuncs.com/to_upload/image-20220128155246789.png" alt="image-20220128155246789"></p>
<h1 id="Java"><a href="#Java" class="headerlink" title="Java"></a>Java</h1><h2 id="bean加载"><a href="#bean加载" class="headerlink" title="bean加载"></a>bean加载</h2><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">@SpringBootApplication</span></span><br><span class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">DemoApplication</span> </span>&#123;</span><br><span class="line"></span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">static</span> <span class="keyword">void</span> <span class="title">main</span><span class="params">(String[] args)</span> </span>&#123;</span><br><span class="line">        SpringApplication.run(DemoApplication.class, args);</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="meta">@Bean</span></span><br><span class="line">    <span class="function"><span class="keyword">public</span> RestTemplate <span class="title">getRestTemplate</span><span class="params">()</span> </span>&#123;</span><br><span class="line">        <span class="keyword">return</span> <span class="keyword">new</span> RestTemplate();</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>



<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">@SpringBootTest</span></span><br><span class="line"><span class="class"><span class="keyword">class</span> <span class="title">DemoApplicationTests</span> </span>&#123;</span><br><span class="line"></span><br><span class="line">    <span class="meta">@Resource</span></span><br><span class="line">    RestTemplate restTemplate;</span><br><span class="line"></span><br><span class="line">    <span class="meta">@Test</span></span><br><span class="line">    <span class="function"><span class="keyword">void</span> <span class="title">contextLoads</span><span class="params">()</span> </span>&#123;</span><br><span class="line">        restTemplate.getErrorHandler();</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>





<h2 id="Python-环境变量配置"><a href="#Python-环境变量配置" class="headerlink" title="Python 环境变量配置"></a>Python 环境变量配置</h2><p><img src="https://picgo-freejim.oss-cn-beijing.aliyuncs.com/to_upload/image-20220129140058272.png" alt="image-20220129140058272"></p>
<p>移动到windows app之前</p>
<h2 id="RestTemplate请求"><a href="#RestTemplate请求" class="headerlink" title="RestTemplate请求"></a>RestTemplate请求</h2><figure class="highlight xml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line"><span class="tag">&lt;<span class="name">dependency</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">groupId</span>&gt;</span>org.apache.httpcomponents<span class="tag">&lt;/<span class="name">groupId</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">artifactId</span>&gt;</span>httpclient<span class="tag">&lt;/<span class="name">artifactId</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">version</span>&gt;</span>4.5.6<span class="tag">&lt;/<span class="name">version</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">dependency</span>&gt;</span></span><br></pre></td></tr></table></figure>



<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">@SpringBootApplication</span></span><br><span class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">DemoApplication</span> </span>&#123;</span><br><span class="line"></span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">static</span> <span class="keyword">void</span> <span class="title">main</span><span class="params">(String[] args)</span> </span>&#123;</span><br><span class="line">        SpringApplication.run(DemoApplication.class, args);</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="meta">@Bean</span></span><br><span class="line">    <span class="function"><span class="keyword">public</span> RestTemplate <span class="title">getRestTemplate</span><span class="params">()</span> </span>&#123;</span><br><span class="line">        <span class="keyword">return</span> <span class="keyword">new</span> RestTemplate();</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">@SpringBootTest</span></span><br><span class="line"><span class="class"><span class="keyword">class</span> <span class="title">DemoApplicationTests</span> </span>&#123;</span><br><span class="line"></span><br><span class="line">    <span class="meta">@Resource</span></span><br><span class="line">    RestTemplate restTemplate;</span><br><span class="line"></span><br><span class="line">    <span class="meta">@Test</span></span><br><span class="line">    <span class="function"><span class="keyword">void</span> <span class="title">contextLoads</span><span class="params">()</span> </span>&#123;</span><br><span class="line">        String content = <span class="keyword">this</span>.restTemplate.getForObject(url, String.class);</span><br><span class="line">        System.out.println(content);</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<h2 id="RestTemplate-的不足"><a href="#RestTemplate-的不足" class="headerlink" title="RestTemplate 的不足"></a>RestTemplate 的不足</h2><p>遇到401没有返回的，直接抛出错误</p>
<h2 id="使用Httpclient"><a href="#使用Httpclient" class="headerlink" title="使用Httpclient"></a>使用Httpclient</h2><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line">String url = <span class="string">&quot;http://192.168.1.108/cgi-bin/configManager.cgi?action=getConfig&amp;name=VideoColor&quot;</span>;</span><br><span class="line">CloseableHttpClient client = HttpClients.createDefault();</span><br><span class="line">HttpGet httpGet = <span class="keyword">new</span> HttpGet(url);</span><br><span class="line">CloseableHttpResponse response = client.execute(httpGet);</span><br><span class="line">System.out.println(response);</span><br><span class="line">client.close();</span><br></pre></td></tr></table></figure>





<h2 id="Digest返回值"><a href="#Digest返回值" class="headerlink" title="Digest返回值"></a>Digest返回值</h2><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">HttpResponseProxy&#123;HTTP/1.1 401 Unauthorized [WWW-Authenticate: Digest realm=&quot;Login to 12da33f08e1f5390345c18b8a00d2306&quot;, qop=&quot;auth&quot;, nonce=&quot;2008728054&quot;, opaque=&quot;3c84793e821a0123f6a75883c540f4f9e0af5590&quot;, Connection: close, Set-Cookie:secure; HttpOnly, CONTENT-LENGTH: 0] [Content-Length: 0,Chunked: false]&#125;</span><br></pre></td></tr></table></figure>

<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">rtsp:<span class="comment">//admin:admin123@192.168.1.108:554/cam/realmonitor?channel=1&amp;subtype=0</span></span><br></pre></td></tr></table></figure>



<h2 id="PostConstruct"><a href="#PostConstruct" class="headerlink" title="@PostConstruct"></a>@PostConstruct</h2><p>首先介绍一下它的用途: 被注解的方法，在对象加载完依赖注入后执行。</p>
<h2 id="Async"><a href="#Async" class="headerlink" title="@Async"></a>@Async</h2><p>异步while循环监听</p>
<h2 id="静态资源访问"><a href="#静态资源访问" class="headerlink" title="静态资源访问"></a>静态资源访问</h2><p>第一步：配置WebMvcConfigurationSupport</p>
<p><a target="_blank" rel="noopener" href="https://gitee.com/simple_one1/spring-boot-static-resource">可参考</a></p>
<p>第二步：路径</p>
<figure class="highlight html"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="tag">&lt;<span class="name">script</span> <span class="attr">src</span>=<span class="string">&quot;/js/video/flv.js&quot;</span>&gt;</span><span class="tag">&lt;/<span class="name">script</span>&gt;</span></span><br></pre></td></tr></table></figure>

<p><img src="https://picgo-freejim.oss-cn-beijing.aliyuncs.com/to_upload/image-20220208153430162.png" alt="image-20220208153430162"></p>
<h2 id="input获取value"><a href="#input获取value" class="headerlink" title="input获取value"></a>input获取value</h2><figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">let</span> videoPath = <span class="built_in">document</span>.getElementById(<span class="string">&#x27;video_path&#x27;</span>);</span><br><span class="line"><span class="keyword">let</span> path = videoPath.value;</span><br></pre></td></tr></table></figure>





<h2 id="websocket-endpoint"><a href="#websocket-endpoint" class="headerlink" title="websocket endpoint"></a>websocket endpoint</h2><h2 id="从配置文件获取值"><a href="#从配置文件获取值" class="headerlink" title="从配置文件获取值"></a>从配置文件获取值</h2><p><code>@Value($&#123;camera.url&#125;)</code></p>
<p>application.properties</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">camera.url = http://192.168.0.108</span><br></pre></td></tr></table></figure>





<h2 id="jar包访问外部静态资源"><a href="#jar包访问外部静态资源" class="headerlink" title="jar包访问外部静态资源"></a>jar包访问外部静态资源</h2><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">package</span> com.dh.live.config;</span><br><span class="line"></span><br><span class="line"><span class="keyword">import</span> org.springframework.context.annotation.Configuration;</span><br><span class="line"><span class="keyword">import</span> org.springframework.web.servlet.config.annotation.ResourceHandlerRegistry;</span><br><span class="line"><span class="keyword">import</span> org.springframework.web.servlet.config.annotation.WebMvcConfigurationSupport;</span><br><span class="line"></span><br><span class="line"><span class="comment">/**</span></span><br><span class="line"><span class="comment"> * <span class="doctag">@author</span> Cola</span></span><br><span class="line"><span class="comment"> * <span class="doctag">@description</span> 静态资源访问</span></span><br><span class="line"><span class="comment"> * <span class="doctag">@date</span> 2022/1/23</span></span><br><span class="line"><span class="comment"> * <span class="doctag">@email</span> 1020151695@qq.com</span></span><br><span class="line"><span class="comment"> */</span></span><br><span class="line"><span class="meta">@Configuration</span></span><br><span class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">WebResoucesConfig</span> <span class="keyword">extends</span> <span class="title">WebMvcConfigurationSupport</span></span></span><br><span class="line"><span class="class"></span>&#123;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">private</span> <span class="keyword">static</span> <span class="keyword">final</span> String[] CLASSPATH_RESOURCE_LOCATIONS = &#123;</span><br><span class="line">                    <span class="string">&quot;classpath:/META-INF/resources/&quot;</span>,</span><br><span class="line">                    <span class="string">&quot;classpath:/resources/&quot;</span>,</span><br><span class="line">                    <span class="string">&quot;classpath:/static/&quot;</span>,</span><br><span class="line">                    <span class="string">&quot;classpath:/templates/&quot;</span>,</span><br><span class="line">                    <span class="string">&quot;classpath:/public/&quot;</span>,</span><br><span class="line">                    <span class="string">&quot;classpath:/custom/&quot;</span>,</span><br><span class="line">                    <span class="string">&quot;file:/root/camera/video/&quot;</span></span><br><span class="line">            &#125;;</span><br><span class="line"></span><br><span class="line">    <span class="meta">@Override</span></span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">addResourceHandlers</span><span class="params">(ResourceHandlerRegistry registry)</span> </span>&#123;</span><br><span class="line">        registry.addResourceHandler(<span class="string">&quot;/**&quot;</span>)</span><br><span class="line">                .addResourceLocations(CLASSPATH_RESOURCE_LOCATIONS)</span><br><span class="line">                .setCachePeriod(<span class="number">3000</span>);</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br></pre></td></tr></table></figure>



<h2 id="Linux下文件排序不同"><a href="#Linux下文件排序不同" class="headerlink" title="Linux下文件排序不同"></a>Linux下文件排序不同</h2><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br></pre></td><td class="code"><pre><span class="line">   <span class="comment">// 递增</span></span><br><span class="line">File[] getFilesList()&#123;</span><br><span class="line">       File file = <span class="keyword">new</span> File(videoDir);</span><br><span class="line">       File[] filesNames = file.listFiles();</span><br><span class="line">       Arrays.sort(filesNames, <span class="keyword">new</span> Comparator&lt;File&gt;() &#123;</span><br><span class="line">           <span class="function"><span class="keyword">public</span> <span class="keyword">int</span> <span class="title">compare</span><span class="params">(File f1, File f2)</span> </span>&#123;</span><br><span class="line">               <span class="keyword">long</span> diff = f1.lastModified() - f2.lastModified();</span><br><span class="line">               <span class="keyword">if</span> (diff &gt; <span class="number">0</span>)</span><br><span class="line">                   <span class="keyword">return</span> <span class="number">1</span>;</span><br><span class="line">               <span class="keyword">else</span> <span class="keyword">if</span> (diff == <span class="number">0</span>)</span><br><span class="line">                   <span class="keyword">return</span> <span class="number">0</span>;</span><br><span class="line">               <span class="keyword">else</span></span><br><span class="line">                   <span class="keyword">return</span> -<span class="number">1</span>;<span class="comment">//如果 if 中修改为 返回-1 同时此处修改为返回 1  排序就会是递减</span></span><br><span class="line">           &#125;</span><br><span class="line"></span><br><span class="line">           <span class="function"><span class="keyword">public</span> <span class="keyword">boolean</span> <span class="title">equals</span><span class="params">(Object obj)</span> </span>&#123;</span><br><span class="line">               <span class="keyword">return</span> <span class="keyword">true</span>;</span><br><span class="line">           &#125;</span><br><span class="line"></span><br><span class="line">       &#125;);</span><br><span class="line">       <span class="keyword">return</span> filesNames;</span><br><span class="line">   &#125;</span><br></pre></td></tr></table></figure>









<h1 id="流媒体"><a href="#流媒体" class="headerlink" title="流媒体"></a>流媒体</h1><h2 id="Digest认证"><a href="#Digest认证" class="headerlink" title="Digest认证"></a>Digest认证</h2><p><img src="https://picgo-freejim.oss-cn-beijing.aliyuncs.com/to_upload/image-20220128165158781.png" alt="image-20220128165158781"></p>
<p>别的参数postman会自动获取</p>
<p>测试接口：</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">http://192.168.1.108/cgi-bin/configManager.cgi?action=getConfig&amp;name=VideoColor</span><br></pre></td></tr></table></figure>



<p>公开流</p>
<figure class="highlight html"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">rtsp://wowzaec2demo.streamlock.net/vod/mp4:BigBuckBunny_115k.mov</span><br></pre></td></tr></table></figure>



<figure class="highlight html"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">rtsp://192.168.1.108:554/cam/realmonitor?channel=1&amp;subtype=0</span><br></pre></td></tr></table></figure>













<h2 id="Digest-认证的Java实现"><a href="#Digest-认证的Java实现" class="headerlink" title="Digest 认证的Java实现"></a>Digest 认证的Java实现</h2><p>postman可以直接做</p>
<p><img src="https://picgo-freejim.oss-cn-beijing.aliyuncs.com/to_upload/image-20220209163912533.png" alt="image-20220209163912533"></p>
<p>有用户名和密码就行</p>
<p>Java也可以直接做</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">@Component</span></span><br><span class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">DigestAuthUtils</span> </span>&#123;</span><br><span class="line">    <span class="comment">// 加密字段</span></span><br><span class="line">    String realm;</span><br><span class="line">    String qop;</span><br><span class="line">    String nonce;</span><br><span class="line">    String opaque;</span><br><span class="line"></span><br><span class="line">    <span class="function"><span class="keyword">public</span> HttpResponse <span class="title">get</span><span class="params">(String url, String username, String password)</span> <span class="keyword">throws</span> IOException, AuthenticationException </span>&#123;</span><br><span class="line">        <span class="comment">// 获取digest</span></span><br><span class="line">        CloseableHttpClient client = HttpClients.createDefault();</span><br><span class="line">        HttpGet httpGet = <span class="keyword">new</span> HttpGet(url);</span><br><span class="line">        HttpResponse response = client.execute(httpGet);</span><br><span class="line">        getDigestInfoFromResponse(response);</span><br><span class="line"></span><br><span class="line">        <span class="comment">// 利用digest信息二次发送请求</span></span><br><span class="line">        UsernamePasswordCredentials creds</span><br><span class="line">                = <span class="keyword">new</span> UsernamePasswordCredentials(username, password);</span><br><span class="line">        DigestScheme digestScheme = buildDigestAuth();</span><br><span class="line">        httpGet = <span class="keyword">new</span> HttpGet(url);</span><br><span class="line">        httpGet.addHeader(digestScheme.authenticate(creds, httpGet, <span class="keyword">null</span>));</span><br><span class="line">        response = client.execute(httpGet);</span><br><span class="line">        <span class="keyword">return</span> response;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">getDigestInfoFromResponse</span><span class="params">(HttpResponse response)</span> </span>&#123;</span><br><span class="line">        HeaderElement[] elements = response.getAllHeaders()[<span class="number">0</span>].getElements();</span><br><span class="line">        realm = getValueFromHeader(elements[<span class="number">0</span>].toString());</span><br><span class="line">        qop = getValueFromHeader(elements[<span class="number">1</span>].toString());</span><br><span class="line">        nonce = getValueFromHeader(elements[<span class="number">2</span>].toString());</span><br><span class="line">        opaque = getValueFromHeader(elements[<span class="number">3</span>].toString());</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="function">String <span class="title">getValueFromHeader</span><span class="params">(String str)</span> </span>&#123;</span><br><span class="line">        <span class="keyword">int</span> begin_index = str.indexOf(<span class="string">&quot;=&quot;</span>) + <span class="number">1</span>;</span><br><span class="line">        <span class="keyword">return</span> str.substring(begin_index, str.length());</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="function"><span class="keyword">public</span> DigestScheme <span class="title">buildDigestAuth</span><span class="params">()</span> </span>&#123;</span><br><span class="line">        DigestScheme digestScheme = <span class="keyword">new</span> DigestScheme();</span><br><span class="line">        digestScheme.overrideParamter(<span class="string">&quot;realm&quot;</span>, realm);</span><br><span class="line">        digestScheme.overrideParamter(<span class="string">&quot;qop&quot;</span>, qop);</span><br><span class="line">        digestScheme.overrideParamter(<span class="string">&quot;nonce&quot;</span>, nonce);</span><br><span class="line">        digestScheme.overrideParamter(<span class="string">&quot;opaque&quot;</span>, opaque);</span><br><span class="line">        <span class="keyword">return</span> digestScheme;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">showContent</span><span class="params">(HttpResponse response)</span> <span class="keyword">throws</span> IOException </span>&#123;</span><br><span class="line">        BufferedReader in = <span class="keyword">new</span> BufferedReader(<span class="keyword">new</span> InputStreamReader(response.getEntity().getContent()));</span><br><span class="line">        StringBuffer sb = <span class="keyword">new</span> StringBuffer(<span class="string">&quot;&quot;</span>);</span><br><span class="line">        String line = <span class="string">&quot;&quot;</span>;</span><br><span class="line">        String NL = System.getProperty(<span class="string">&quot;line.separator&quot;</span>);</span><br><span class="line">        <span class="keyword">while</span> ((line = in.readLine()) != <span class="keyword">null</span>) &#123;</span><br><span class="line">            sb.append(line + NL);</span><br><span class="line">        &#125;</span><br><span class="line">        System.out.println(sb.toString());</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>





<h2 id="rtsp账号密码验证"><a href="#rtsp账号密码验证" class="headerlink" title="rtsp账号密码验证"></a>rtsp账号密码验证</h2><p><code>url</code> 中体现就行</p>
<h2 id="TCP一样失真"><a href="#TCP一样失真" class="headerlink" title="TCP一样失真"></a>TCP一样失真</h2><h2 id="buffer大小设置"><a href="#buffer大小设置" class="headerlink" title="buffer大小设置"></a>buffer大小设置</h2><p>太大，IO流的操作会引起卡顿，延迟会拉得很严重</p>
<p>太小，一帧存不下就会失真，但可以减小延迟</p>
<h2 id="flush"><a href="#flush" class="headerlink" title="flush"></a>flush</h2><p>方法是用来刷新缓冲区的，即将缓冲区中的数据立刻写入文件，同时清空缓冲区，不需要是被动的等待输出缓冲区写入。</p>
<p>一般情况下，文件关闭后会自动刷新缓冲区，但有时你需要在关闭前刷新它，这时就可以使用 flush() 方法。</p>
<h2 id="flush-配置"><a href="#flush-配置" class="headerlink" title="flush 配置"></a>flush 配置</h2><p>不配置的话会报错</p>
<h2 id="解决间隔的卡顿问题"><a href="#解决间隔的卡顿问题" class="headerlink" title="解决间隔的卡顿问题"></a>解决间隔的卡顿问题</h2><p>减小buffer</p>
<p>卡一下，但是视频都是有推过来的</p>
<p>可以拉进度条到前边</p>
<h2 id="移动失真问题"><a href="#移动失真问题" class="headerlink" title="移动失真问题"></a>移动失真问题</h2><h2 id="grabber和recorder-的参数设置"><a href="#grabber和recorder-的参数设置" class="headerlink" title="grabber和recorder 的参数设置"></a>grabber和recorder 的参数设置</h2><p>grabber</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line">grabber = FFmpegFrameGrabber.createDefault(rtsp);</span><br><span class="line">         grabber.setOption(<span class="string">&quot;rtsp_transport&quot;</span>, <span class="string">&quot;udp&quot;</span>);</span><br><span class="line">         grabber.setFrameRate(<span class="number">25</span>);</span><br><span class="line">         grabber.setVideoBitrate(<span class="number">2500000</span>);</span><br><span class="line">         <span class="comment">//grabber.setOption(&quot;buffer_size&quot;, &quot;1024000&quot;);</span></span><br><span class="line">         grabber.setOption(<span class="string">&quot;buffer_size&quot;</span>, <span class="string">&quot;300000&quot;</span>);</span><br><span class="line">         grabber.setPixelFormat(avutil.AV_PIX_FMT_YUV420P);</span><br><span class="line">         grabber.start();</span><br></pre></td></tr></table></figure>



<p>recorder</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br></pre></td><td class="code"><pre><span class="line">recorder = <span class="keyword">new</span> FFmpegFrameRecorder(outputStream, grabber.getImageWidth(), grabber.getImageHeight(), grabber.getAudioChannels());</span><br><span class="line">         recorder.setVideoCodec(avcodec.AV_CODEC_ID_H264);</span><br><span class="line">         recorder.setFormat(<span class="string">&quot;flv&quot;</span>);</span><br><span class="line">         recorder.setInterleaved(<span class="keyword">false</span>);</span><br><span class="line">         recorder.setVideoOption(<span class="string">&quot;tune&quot;</span>, <span class="string">&quot;zerolatency&quot;</span>);</span><br><span class="line">         recorder.setVideoOption(<span class="string">&quot;preset&quot;</span>, <span class="string">&quot;ultrafast&quot;</span>);</span><br><span class="line">         recorder.setVideoOption(<span class="string">&quot;crf&quot;</span>, <span class="string">&quot;26&quot;</span>);</span><br><span class="line">         recorder.setVideoOption(<span class="string">&quot;threads&quot;</span>, <span class="string">&quot;1&quot;</span>);</span><br><span class="line">         <span class="comment">//帧率25</span></span><br><span class="line">         recorder.setFrameRate(grabber.getFrameRate());</span><br><span class="line"><span class="comment">// 设置gop,与帧率相同，相当于间隔1秒chan&#x27;s一个关键帧</span></span><br><span class="line">         recorder.setGopSize(<span class="number">25</span>);</span><br><span class="line"><span class="comment">// 码率500kb/s</span></span><br><span class="line">         recorder.setVideoBitrate(grabber.getVideoBitrate());</span><br><span class="line">         recorder.setVideoCodecName(<span class="string">&quot;libx264&quot;</span>);</span><br><span class="line">         recorder.setPixelFormat(avutil.AV_PIX_FMT_YUV420P);</span><br><span class="line">         recorder.setAudioCodecName(<span class="string">&quot;aac&quot;</span>);</span><br></pre></td></tr></table></figure>







<h2 id="比特率"><a href="#比特率" class="headerlink" title="比特率"></a>比特率</h2><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">// 500 kb/s</span><br><span class="line">500*1000</span><br></pre></td></tr></table></figure>





<h2 id="websocket设置"><a href="#websocket设置" class="headerlink" title="websocket设置"></a>websocket设置</h2><h2 id="线程操作"><a href="#线程操作" class="headerlink" title="线程操作"></a>线程操作</h2><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">new</span> Thread(() -&gt; &#123;</span><br><span class="line">             ...</span><br><span class="line">         &#125;).start();</span><br></pre></td></tr></table></figure>







<h2 id="异步操作"><a href="#异步操作" class="headerlink" title="异步操作"></a>异步操作</h2><p><code>@Async</code></p>
<h2 id="流媒体后端传输视频"><a href="#流媒体后端传输视频" class="headerlink" title="流媒体后端传输视频"></a>流媒体后端传输视频</h2><p>往outputStream里放东西</p>
<p>JavaCV的recorder可以完成</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">while</span> (isStart &amp;&amp; (frame = grabber.grabFrame()) != <span class="keyword">null</span>) &#123;</span><br><span class="line">                <span class="comment">// grab的速度是够快的</span></span><br><span class="line">                <span class="comment">// record传到outputStream</span></span><br><span class="line">                recorder.record(frame);</span><br><span class="line">            &#125;</span><br></pre></td></tr></table></figure>



<h2 id="流媒体前端"><a href="#流媒体前端" class="headerlink" title="流媒体前端"></a>流媒体前端</h2><figure class="highlight html"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br></pre></td><td class="code"><pre><span class="line"><span class="tag">&lt;<span class="name">script</span> <span class="attr">src</span>=<span class="string">&quot;/flv.js&quot;</span>&gt;</span><span class="tag">&lt;/<span class="name">script</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">script</span> <span class="attr">src</span>=<span class="string">&quot;/jquery.min.js&quot;</span>&gt;</span><span class="tag">&lt;/<span class="name">script</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">script</span>&gt;</span><span class="javascript"></span></span><br><span class="line"><span class="javascript">    <span class="keyword">let</span> videoElement = <span class="built_in">document</span>.getElementById(<span class="string">&#x27;videoElement&#x27;</span>);</span></span><br><span class="line"><span class="javascript">    <span class="keyword">let</span> videoPath = <span class="built_in">document</span>.getElementById(<span class="string">&#x27;video_path&#x27;</span>);</span></span><br><span class="line"><span class="javascript">    <span class="function"><span class="keyword">function</span> <span class="title">resetUrl</span>(<span class="params">url</span>) </span>&#123;</span></span><br><span class="line"><span class="javascript">        <span class="keyword">if</span> (flvjs.isSupported()) &#123;</span></span><br><span class="line"><span class="javascript">            <span class="keyword">let</span> flvPlayer = flvjs.createPlayer(&#123;</span></span><br><span class="line"><span class="javascript">                <span class="attr">type</span>: <span class="string">&#x27;flv&#x27;</span>,</span></span><br><span class="line"><span class="javascript">                <span class="attr">isLive</span>: <span class="literal">true</span>,</span></span><br><span class="line"><span class="javascript">                <span class="attr">url</span>: url,</span></span><br><span class="line"><span class="javascript">            &#125;);</span></span><br><span class="line"><span class="javascript">            flvPlayer.attachMediaElement(videoElement);</span></span><br><span class="line"><span class="javascript">            flvPlayer.load();</span></span><br><span class="line"><span class="javascript">            flvPlayer.play()</span></span><br><span class="line"><span class="javascript">            flv_start();</span></span><br><span class="line"><span class="javascript">        &#125;</span></span><br><span class="line"><span class="javascript">    &#125;</span></span><br><span class="line"><span class="javascript"></span></span><br><span class="line"><span class="javascript">    <span class="function"><span class="keyword">function</span> <span class="title">flv_start</span>(<span class="params"></span>) </span>&#123;</span></span><br><span class="line"><span class="javascript">        videoElement.play();</span></span><br><span class="line"><span class="javascript">    &#125;</span></span><br><span class="line"><span class="javascript"></span></span><br><span class="line"><span class="javascript">    <span class="function"><span class="keyword">function</span> <span class="title">changePath</span>(<span class="params"></span>) </span>&#123;</span></span><br><span class="line"><span class="javascript">        <span class="keyword">let</span> path = videoPath.value</span></span><br><span class="line"><span class="javascript">        <span class="built_in">console</span>.log(path)</span></span><br><span class="line"><span class="javascript">        <span class="keyword">if</span> (path === <span class="literal">null</span> || path === <span class="string">&quot;&quot;</span>) &#123;</span></span><br><span class="line"><span class="javascript">            alert(<span class="string">&quot;请输入地址&quot;</span>)</span></span><br><span class="line"><span class="javascript">            <span class="keyword">return</span></span></span><br><span class="line"><span class="javascript">        &#125;</span></span><br><span class="line"><span class="javascript">        $.ajax(&#123;</span></span><br><span class="line"><span class="javascript">            <span class="attr">type</span>: <span class="string">&quot;POST&quot;</span>,</span></span><br><span class="line"><span class="javascript">            <span class="attr">url</span>: <span class="string">&quot;/putVideo&quot;</span>,</span></span><br><span class="line"><span class="javascript">            <span class="attr">data</span>: &#123;<span class="attr">path</span>: path&#125;,</span></span><br><span class="line"><span class="javascript">            <span class="attr">success</span>: <span class="function"><span class="keyword">function</span> (<span class="params">result</span>) </span>&#123;</span></span><br><span class="line"><span class="javascript">                <span class="keyword">if</span> (result.code === <span class="number">0</span>) &#123;</span></span><br><span class="line"><span class="javascript">                    resetUrl(<span class="string">&quot;/getVideo?id=&quot;</span> + result.data)</span></span><br><span class="line"><span class="javascript">                &#125;</span></span><br><span class="line"><span class="javascript">            &#125;,</span></span><br><span class="line"><span class="javascript">            <span class="attr">error</span>: <span class="function"><span class="keyword">function</span> (<span class="params"></span>) </span>&#123;</span></span><br><span class="line"><span class="javascript">                alert(<span class="string">&quot;请求出错&quot;</span>)</span></span><br><span class="line"><span class="javascript">            &#125;</span></span><br><span class="line"><span class="javascript">        &#125;)</span></span><br><span class="line"><span class="javascript">    &#125;</span></span><br><span class="line"><span class="javascript"></span><span class="tag">&lt;/<span class="name">script</span>&gt;</span></span><br></pre></td></tr></table></figure>





<h2 id="解码"><a href="#解码" class="headerlink" title="解码"></a>解码</h2><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">Input #0, rtsp, from &#x27;rtsp://admin:admin123..&#x27;</span><br><span class="line">Stream #0:0: Video: h264 (High), yuvj420p(pc, bt470bg/bt470bg/bt709, progressive), 704x576, 25 fps, 25 tbr, 90k tbn, 50 tbc</span><br></pre></td></tr></table></figure>

<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">Output</span><br><span class="line">Stream #0:0: Video: mpeg4</span><br></pre></td></tr></table></figure>

<p>编码格式是h264</p>
<p>视频容器是mp4</p>
<h2 id="报错"><a href="#报错" class="headerlink" title="报错"></a>报错</h2><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">(Has setFormat() been called?)</span><br></pre></td></tr></table></figure>

<p>不能调用setFormat()</p>
<h2 id="视频和直播视频流"><a href="#视频和直播视频流" class="headerlink" title="视频和直播视频流"></a>视频和直播视频流</h2><p>直播视频流卡，但是视频不卡</p>
<h1 id="云台移动"><a href="#云台移动" class="headerlink" title="云台移动"></a>云台移动</h1><h2 id="up"><a href="#up" class="headerlink" title="up"></a>up</h2><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">http://192.168.1.108/cgi-bin/ptz.cgi?action=moveRelatively&amp;channel=1&amp;arg1=0&amp;arg2=0.05&amp;arg3=0</span><br></pre></td></tr></table></figure>

<p>相对变倍量，zoom</p>
<p>没事不去动这个量</p>
<h1 id="云台变焦"><a href="#云台变焦" class="headerlink" title="云台变焦"></a>云台变焦</h1><h1 id="云部署"><a href="#云部署" class="headerlink" title="云部署"></a>云部署</h1><h2 id="内网的机器"><a href="#内网的机器" class="headerlink" title="内网的机器"></a>内网的机器</h2><p>路由器配置ddns后</p>
<p><img src="https://picgo-freejim.oss-cn-beijing.aliyuncs.com/to_upload/image-20220210101319145.png" alt="image-20220210101319145"></p>
<h2 id="公网IP"><a href="#公网IP" class="headerlink" title="公网IP"></a>公网IP</h2><p><img src="https://picgo-freejim.oss-cn-beijing.aliyuncs.com/to_upload/image-20220209104916940.png" alt="image-20220209104916940"></p>
<p><img src="https://picgo-freejim.oss-cn-beijing.aliyuncs.com/to_upload/image-20220209104945261.png" alt="image-20220209104945261"></p>
<h2 id="内网穿透"><a href="#内网穿透" class="headerlink" title="内网穿透"></a>内网穿透</h2><p><img src="https://picgo-freejim.oss-cn-beijing.aliyuncs.com/to_upload/image-20220209105703676.png" alt="image-20220209105703676"></p>
<p>有公网IP服务器，自行搭建内网穿透，一般可以考虑开源的如：ngrok、frp。</p>
<p>无公网IP，一般是用现有提供的一些内网穿透服务，类似如：nat123全端口P2P穿透。等。</p>
<h2 id="DDNS"><a href="#DDNS" class="headerlink" title="DDNS"></a>DDNS</h2><p>就是机器会自动获取它自己最新的IP</p>
<p>然后更新到DNS服务器</p>
<h1 id="需求"><a href="#需求" class="headerlink" title="需求"></a>需求</h1><p>视频监控、监控存储、监控回放</p>
<p>云台控制</p>
<p><img src="https://picgo-freejim.oss-cn-beijing.aliyuncs.com/to_upload/image-20220209143014527.png" alt="image-20220209143014527"></p>
<h1 id="JavaCV"><a href="#JavaCV" class="headerlink" title="JavaCV"></a>JavaCV</h1><h2 id="recorder-stop"><a href="#recorder-stop" class="headerlink" title="recorder.stop()"></a>recorder.stop()</h2><p>当我们在录制文件的时候，一定要保证stop()方法被调用，因为stop里面包含了写出文件头的操作，如果没有调用stop就会导致录制的文件损坏，无法被识别或无法播放。</p>
<h2 id="pixel-format"><a href="#pixel-format" class="headerlink" title="pixel format"></a>pixel format</h2><p>该参数并不像ffmpeg那样表示像素格式，这里只表示原生和灰度图，其中pixelFormat=1表示原生，pixelFormat=0表示灰度图。</p>
<h2 id="JavaCV太大"><a href="#JavaCV太大" class="headerlink" title="JavaCV太大"></a>JavaCV太大</h2><p><img src="https://picgo-freejim.oss-cn-beijing.aliyuncs.com/to_upload/image-20220218101018839.png" alt="image-20220218101018839"></p>
<p>下面进行阉割</p>
<p>pom</p>
<p>Windows</p>
<figure class="highlight xml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br></pre></td><td class="code"><pre><span class="line"><span class="tag">&lt;<span class="name">dependency</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">groupId</span>&gt;</span>org.bytedeco<span class="tag">&lt;/<span class="name">groupId</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">artifactId</span>&gt;</span>javacv<span class="tag">&lt;/<span class="name">artifactId</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">version</span>&gt;</span>1.5.2<span class="tag">&lt;/<span class="name">version</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">dependency</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">dependency</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">groupId</span>&gt;</span>org.bytedeco<span class="tag">&lt;/<span class="name">groupId</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">artifactId</span>&gt;</span>javacpp<span class="tag">&lt;/<span class="name">artifactId</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">version</span>&gt;</span>1.5.2<span class="tag">&lt;/<span class="name">version</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">dependency</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">dependency</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">groupId</span>&gt;</span>org.bytedeco<span class="tag">&lt;/<span class="name">groupId</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">artifactId</span>&gt;</span>opencv<span class="tag">&lt;/<span class="name">artifactId</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">version</span>&gt;</span>4.1.2-1.5.2<span class="tag">&lt;/<span class="name">version</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">classifier</span>&gt;</span>windows-x86_64<span class="tag">&lt;/<span class="name">classifier</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">dependency</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">dependency</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">groupId</span>&gt;</span>org.bytedeco<span class="tag">&lt;/<span class="name">groupId</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">artifactId</span>&gt;</span>openblas<span class="tag">&lt;/<span class="name">artifactId</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">version</span>&gt;</span>0.3.7-1.5.2<span class="tag">&lt;/<span class="name">version</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">classifier</span>&gt;</span>windows-x86_64<span class="tag">&lt;/<span class="name">classifier</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">dependency</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">dependency</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">groupId</span>&gt;</span>org.bytedeco<span class="tag">&lt;/<span class="name">groupId</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">artifactId</span>&gt;</span>ffmpeg<span class="tag">&lt;/<span class="name">artifactId</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">version</span>&gt;</span>4.2.1-1.5.2<span class="tag">&lt;/<span class="name">version</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">classifier</span>&gt;</span>windows-x86_64<span class="tag">&lt;/<span class="name">classifier</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">dependency</span>&gt;</span></span><br></pre></td></tr></table></figure>



<p>Linux</p>
<figure class="highlight xml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br></pre></td><td class="code"><pre><span class="line"><span class="tag">&lt;<span class="name">dependency</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">groupId</span>&gt;</span>org.bytedeco<span class="tag">&lt;/<span class="name">groupId</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">artifactId</span>&gt;</span>javacv<span class="tag">&lt;/<span class="name">artifactId</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">version</span>&gt;</span>1.5.2<span class="tag">&lt;/<span class="name">version</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">dependency</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">dependency</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">groupId</span>&gt;</span>org.bytedeco<span class="tag">&lt;/<span class="name">groupId</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">artifactId</span>&gt;</span>javacpp<span class="tag">&lt;/<span class="name">artifactId</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">version</span>&gt;</span>1.5.2<span class="tag">&lt;/<span class="name">version</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">dependency</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">dependency</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">groupId</span>&gt;</span>org.bytedeco<span class="tag">&lt;/<span class="name">groupId</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">artifactId</span>&gt;</span>opencv<span class="tag">&lt;/<span class="name">artifactId</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">version</span>&gt;</span>4.1.2-1.5.2<span class="tag">&lt;/<span class="name">version</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">classifier</span>&gt;</span>linux-x86_64<span class="tag">&lt;/<span class="name">classifier</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">dependency</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">dependency</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">groupId</span>&gt;</span>org.bytedeco<span class="tag">&lt;/<span class="name">groupId</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">artifactId</span>&gt;</span>openblas<span class="tag">&lt;/<span class="name">artifactId</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">version</span>&gt;</span>0.3.7-1.5.2<span class="tag">&lt;/<span class="name">version</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">classifier</span>&gt;</span>linux-x86_64<span class="tag">&lt;/<span class="name">classifier</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">dependency</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">dependency</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">groupId</span>&gt;</span>org.bytedeco<span class="tag">&lt;/<span class="name">groupId</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">artifactId</span>&gt;</span>ffmpeg<span class="tag">&lt;/<span class="name">artifactId</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">version</span>&gt;</span>4.2.1-1.5.2<span class="tag">&lt;/<span class="name">version</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">classifier</span>&gt;</span>linux-x86_64<span class="tag">&lt;/<span class="name">classifier</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">dependency</span>&gt;</span></span><br></pre></td></tr></table></figure>











<h1 id="监控存储"><a href="#监控存储" class="headerlink" title="监控存储"></a>监控存储</h1><p>现在的解决方案是：</p>
<p>把流媒体切片保存在服务器</p>
<p>然后根据请求的时段获取若干切片</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"></span><br></pre></td></tr></table></figure>







<h2 id="解决方案"><a href="#解决方案" class="headerlink" title="解决方案"></a>解决方案</h2><h3 id="NVR"><a href="#NVR" class="headerlink" title="NVR"></a>NVR</h3><p><img src="https://picgo-freejim.oss-cn-beijing.aliyuncs.com/to_upload/image-20220215134809280.png" alt="image-20220215134809280"></p>
<h3 id="IP-SAN"><a href="#IP-SAN" class="headerlink" title="IP-SAN"></a>IP-SAN</h3><p><img src="https://picgo-freejim.oss-cn-beijing.aliyuncs.com/to_upload/image-20220215135118485.png" alt="image-20220215135118485"></p>
<h2 id="HLS"><a href="#HLS" class="headerlink" title="HLS"></a>HLS</h2><p><img src="https://picgo-freejim.oss-cn-beijing.aliyuncs.com/to_upload/image-20220215180045023.png" alt="image-20220215180045023"></p>
<p>至于为什么要用 TS 而不是 MP4</p>
<p>这是因为两个 TS 片段可以无缝拼接，播放器能连续播放</p>
<p>而 MP4 文件由于编码方式的原因，两段 MP4 不能无缝拼接</p>
<p>播放器连续播放两个 MP4 文件会出现破音和画面间断，影响用户体验。</p>
<h2 id="ffmpeg怎么读"><a href="#ffmpeg怎么读" class="headerlink" title="ffmpeg怎么读"></a>ffmpeg怎么读</h2><p>[‘efef’empeɡ]</p>
<h2 id="ffmpeg-rtsp保存为ts"><a href="#ffmpeg-rtsp保存为ts" class="headerlink" title="ffmpeg rtsp保存为ts"></a>ffmpeg rtsp保存为ts</h2><p>Windows</p>
<figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">ffmpeg  -rtsp_transport udp -i rtsp://admin:admin123@192.168.1.108:554 -vcodec copy -f segment -segment_time 10  -segment_atclocktime 1 -strftime 1 &quot;G:\Project\智慧灯杆\摄像头\dahua\live\target\classes\static\video%Y-%m-%d_%H-%M-%S.ts&quot;</span><br></pre></td></tr></table></figure>

<p>Linux</p>
<figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">ffmpeg  -rtsp_transport udp -i rtsp://admin:admin123@192.168.1.108:554 -vcodec copy -f segment -segment_time 10  -segment_atclocktime 1 -strftime 1 &quot;/root/camera/video/video%Y-%m-%d_%H-%M-%S.ts&quot;</span><br></pre></td></tr></table></figure>







<h2 id="ffmpeg视频时长"><a href="#ffmpeg视频时长" class="headerlink" title="ffmpeg视频时长"></a>ffmpeg视频时长</h2><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line">while (status &amp;&amp; (frame = grabber.grabFrame()) != null) &#123;</span><br><span class="line">          recorder.record(frame);</span><br><span class="line">          long nowTime = System.currentTimeMillis(); //此处为视频时长，根据需求设定自己的值</span><br><span class="line">         if (nowTime - beginTime &gt;= 60*1000) break;</span><br><span class="line">      &#125;</span><br></pre></td></tr></table></figure>



<p>ffmpeg的视频时长也会出错！</p>
<p>同时运行两个ffmpeg时，视频时长显示错误 ！</p>
<p>说明，超帧率的帧数会导致视频时长显示错误</p>
<h2 id="视频时间不对"><a href="#视频时间不对" class="headerlink" title="视频时间不对"></a>视频时间不对</h2><p>while写的话，1s内塞了不止25帧的话，时间就对不上了</p>
<p>右上角看似是过了一秒</p>
<h2 id="ffmpeg分片"><a href="#ffmpeg分片" class="headerlink" title="ffmpeg分片"></a>ffmpeg分片</h2><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">ffmpeg -i test.avi -c:v libx264 -c:a aac  -f hls test.m3u8</span><br></pre></td></tr></table></figure>



<h2 id="m3u8"><a href="#m3u8" class="headerlink" title="m3u8"></a>m3u8</h2><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br></pre></td><td class="code"><pre><span class="line">// #开头的字符串要么是注释，要么就是标签</span><br><span class="line"></span><br><span class="line">// 表明该文件是一个 m3u8 文件。每个 M3U 文件必须将该标签放置在第一行。</span><br><span class="line">#EXTM3U</span><br><span class="line"></span><br><span class="line">// 表示 HLS 的协议版本号，该标签与流媒体的兼容性相关。</span><br><span class="line">#EXT-X-VERSION:3</span><br><span class="line"></span><br><span class="line">// 表示每个视频分段最大的时长</span><br><span class="line">#EXT-X-TARGETDURATION:8</span><br><span class="line"></span><br><span class="line">// 表示播放列表第一个 URL 片段文件的序列号。</span><br><span class="line">#EXT-X-MEDIA-SEQUENCE:13</span><br><span class="line"></span><br><span class="line">// 表示其后 URL 指定的媒体片段时长（单位为秒）。</span><br><span class="line">// 时间偏大的话，画面静止，直到下一视频段</span><br><span class="line">#EXTINF:8.341667,</span><br><span class="line">test13.ts</span><br><span class="line">#EXTINF:8.341667,</span><br><span class="line">test14.ts</span><br><span class="line">#EXTINF:8.341667,</span><br><span class="line">test15.ts</span><br><span class="line">#EXTINF:7.340667,</span><br><span class="line">test16.ts</span><br><span class="line">#EXTINF:5.372033,</span><br><span class="line">test17.ts</span><br><span class="line"></span><br><span class="line">// 表明 m3u8 文件的结束。</span><br><span class="line">#EXT-X-ENDLIST</span><br><span class="line"></span><br></pre></td></tr></table></figure>



<p>存的视频文件有问题</p>
<h2 id="m3u8前端"><a href="#m3u8前端" class="headerlink" title="m3u8前端"></a>m3u8前端</h2><p>需要的<code>js</code>文件记得引入</p>
<figure class="highlight html"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">&lt;!DOCTYPE <span class="meta-keyword">html</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">html</span> <span class="attr">lang</span>=<span class="string">&quot;en&quot;</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">head</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">meta</span> <span class="attr">charset</span>=<span class="string">&quot;UTF-8&quot;</span> /&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">title</span>&gt;</span>videojs视频播放DEMO<span class="tag">&lt;/<span class="name">title</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">head</span>&gt;</span></span><br><span class="line"><span class="comment">&lt;!--videojs7.6.6--&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">link</span> <span class="attr">href</span>=<span class="string">&quot;/video-js.min.css&quot;</span> <span class="attr">rel</span>=<span class="string">&quot;stylesheet&quot;</span> /&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">script</span> <span class="attr">src</span>=<span class="string">&quot;/video.js&quot;</span>&gt;</span><span class="tag">&lt;/<span class="name">script</span>&gt;</span></span><br><span class="line"><span class="comment">&lt;!--&lt;script src=&quot;videojs-contrib-hls.js&quot;&gt;&lt;/script&gt;--&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">body</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">h3</span>&gt;</span>视频播放<span class="tag">&lt;/<span class="name">h3</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">video</span></span></span><br><span class="line"><span class="tag">        <span class="attr">id</span>=<span class="string">&quot;example_video_1&quot;</span></span></span><br><span class="line"><span class="tag">        <span class="attr">class</span>=<span class="string">&quot;video-js vjs-default-skin&quot;</span></span></span><br><span class="line"><span class="tag">        <span class="attr">preload</span>=<span class="string">&quot;auto&quot;</span></span></span><br><span class="line"><span class="tag">        <span class="attr">poster</span>=<span class="string">&quot;http://vjs.zencdn.net/v/oceans.png&quot;</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">source</span> <span class="attr">src</span>=<span class="string">&quot;./test.m3u8&quot;</span> <span class="attr">type</span>=<span class="string">&quot;application/x-mpegURL&quot;</span>/&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">video</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">body</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">html</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">script</span>&gt;</span><span class="javascript"></span></span><br><span class="line"><span class="javascript">    <span class="keyword">var</span> player = videojs(<span class="string">&quot;example_video_1&quot;</span>, &#123;</span></span><br><span class="line"><span class="javascript">        <span class="attr">muted</span>: <span class="literal">true</span>,</span></span><br><span class="line"><span class="javascript">        <span class="attr">controls</span>: <span class="literal">true</span>,</span></span><br><span class="line"><span class="javascript">        <span class="attr">height</span>: <span class="number">300</span>,</span></span><br><span class="line"><span class="javascript">        <span class="attr">width</span>: <span class="number">400</span>,</span></span><br><span class="line"><span class="javascript">    &#125;);</span></span><br><span class="line"><span class="javascript"></span><span class="tag">&lt;/<span class="name">script</span>&gt;</span></span><br><span class="line"></span><br><span class="line"></span><br></pre></td></tr></table></figure>











<h1 id="视频编码"><a href="#视频编码" class="headerlink" title="视频编码"></a>视频编码</h1><h2 id="为什么"><a href="#为什么" class="headerlink" title="为什么"></a>为什么</h2><p><strong>“所有的视频都一定要编码吗？”</strong> </p>
<p>答案是肯定的。相信查看其他人的博客的理由是一样的：</p>
<p><strong>不经过压缩的视频太大！在网络传输时对带宽的要求和压力太大！</strong></p>
<h2 id="封装格式"><a href="#封装格式" class="headerlink" title="封装格式"></a>封装格式</h2><p>如：MP4、FLV、AVI</p>
<p>编码格式一样</p>
<p>直接改后缀名就可以</p>
<p>需要重新编码的情况是编码格式不一致</p>
<p><img src="https://picgo-freejim.oss-cn-beijing.aliyuncs.com/to_upload/image-20220217104343024.png" alt="image-20220217104343024"></p>
<h2 id="编码格式"><a href="#编码格式" class="headerlink" title="编码格式"></a>编码格式</h2><p>如：H.264</p>
<h2 id="码率"><a href="#码率" class="headerlink" title="码率"></a>码率</h2><h2 id="视频压缩"><a href="#视频压缩" class="headerlink" title="视频压缩"></a>视频压缩</h2><p>帧内压缩：</p>
<p>丢弃颜色细节</p>
<p><img src="https://picgo-freejim.oss-cn-beijing.aliyuncs.com/to_upload/image-20220217104631215.png" alt="image-20220217104631215"></p>
<p><img src="https://picgo-freejim.oss-cn-beijing.aliyuncs.com/to_upload/image-20220217104730660.png" alt="image-20220217104730660"></p>
<p>如果是画面复杂，则压缩之后会失真（信息量太大）</p>
<p><img src="https://picgo-freejim.oss-cn-beijing.aliyuncs.com/to_upload/image-20220217105010584.png" alt="image-20220217105010584"></p>
<h2 id="GOP"><a href="#GOP" class="headerlink" title="GOP"></a>GOP</h2><p>Group Of Picture</p>
<h2 id="CBR"><a href="#CBR" class="headerlink" title="CBR"></a>CBR</h2><p>固定码率</p>
<h2 id="VBR"><a href="#VBR" class="headerlink" title="VBR"></a>VBR</h2><p>根据实际画面分配不同的码率</p>
<h2 id="CRF"><a href="#CRF" class="headerlink" title="CRF"></a>CRF</h2><p>比VBR更优，但是最后生成出来的文件大小不可控</p>
<h2 id="编码器"><a href="#编码器" class="headerlink" title="编码器"></a>编码器</h2><p><img src="https://picgo-freejim.oss-cn-beijing.aliyuncs.com/to_upload/image-20220217105454207.png" alt="image-20220217105454207"></p>
<p>x264 CPU编码器相对好</p>
<h2 id="MPEG-PS"><a href="#MPEG-PS" class="headerlink" title="MPEG-PS"></a>MPEG-PS</h2><p>传送流（TS：TransportStream）和节目流（PS：ProgramStream）</p>
<h1 id="Git"><a href="#Git" class="headerlink" title="Git"></a>Git</h1><h2 id="新分支"><a href="#新分支" class="headerlink" title="新分支"></a>新分支</h2><p>直接在当前基础上建一个新的分支，而不是完全空的</p>
<h1 id="SDK"><a href="#SDK" class="headerlink" title="SDK"></a>SDK</h1><h2 id="句柄"><a href="#句柄" class="headerlink" title="句柄"></a>句柄</h2><p>句柄就是个数字，一般和当前系统下的整数的位数一样，比如32bit系统下就是4个字节。</p>
<p>这个数字是一个对象的唯一标示，和对象一一对应。</p>
<p>这个对象可以是一个块内存，一个资源，或者一个服务的context（如 socket，thread）等等。</p>
<p>这样说有点抽象，举个例子。door handle 是指门把手，通过门把手可以去控制门，但 door handle 并非 door 本身，只是一个中间媒介。又比如 knife handle 是刀柄，通过刀柄可以使用刀。</p>
<p>跟 door handle 类似，我们可以用 file handle 去操作 file, 但 file handle 并非 file 本身。这个 file handle 就被翻译成文件句柄，同理还有各种资源句柄。</p>
<h1 id="Intellij"><a href="#Intellij" class="headerlink" title="Intellij"></a>Intellij</h1><h2 id="intellij-子模块（待补充）"><a href="#intellij-子模块（待补充）" class="headerlink" title="intellij 子模块（待补充）"></a>intellij 子模块（待补充）</h2><figure class="highlight xml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line"><span class="tag">&lt;<span class="name">packaging</span>&gt;</span>pom<span class="tag">&lt;/<span class="name">packaging</span>&gt;</span></span><br><span class="line">   <span class="tag">&lt;<span class="name">modules</span>&gt;</span></span><br><span class="line">       <span class="tag">&lt;<span class="name">module</span>&gt;</span>auth<span class="tag">&lt;/<span class="name">module</span>&gt;</span></span><br><span class="line">   <span class="tag">&lt;/<span class="name">modules</span>&gt;</span></span><br></pre></td></tr></table></figure>

<p><img src="https://picgo-freejim.oss-cn-beijing.aliyuncs.com/to_upload/image-20220208143559167.png" alt="image-20220208143559167"></p>
<h2 id="intellij-导入其他子模块的工具类"><a href="#intellij-导入其他子模块的工具类" class="headerlink" title="intellij 导入其他子模块的工具类"></a>intellij 导入其他子模块的工具类</h2><p>不设置的话</p>
<p>导不进的</p>
<figure class="highlight xml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line"><span class="tag">&lt;<span class="name">dependency</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">groupId</span>&gt;</span>com.dh<span class="tag">&lt;/<span class="name">groupId</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">artifactId</span>&gt;</span>auth<span class="tag">&lt;/<span class="name">artifactId</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">version</span>&gt;</span>0.0.1-SNAPSHOT<span class="tag">&lt;/<span class="name">version</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">scope</span>&gt;</span>compile<span class="tag">&lt;/<span class="name">scope</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">dependency</span>&gt;</span></span><br></pre></td></tr></table></figure>











<h1 id="脚本"><a href="#脚本" class="headerlink" title="脚本"></a>脚本</h1><h2 id="定时任务"><a href="#定时任务" class="headerlink" title="定时任务"></a>定时任务</h2><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">crontab -e</span><br></pre></td></tr></table></figure>

<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">*/1 * * * * . /root/camera/sh/startFFmpeg.sh</span><br></pre></td></tr></table></figure>



<h2 id="定时清理录像和m3u8"><a href="#定时清理录像和m3u8" class="headerlink" title="定时清理录像和m3u8"></a>定时清理录像和m3u8</h2><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">#</span><span class="bash"> +7表示清理指定目录7天前的文件</span></span><br><span class="line">find /root/camera/video/ -mtime +7 -name &quot;*.*&quot; -exec rm -Rf &#123;&#125; \;</span><br></pre></td></tr></table></figure>





<h2 id="启动ffmpeg推流"><a href="#启动ffmpeg推流" class="headerlink" title="启动ffmpeg推流"></a>启动ffmpeg推流</h2><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><span class="line">ffmpeg_status=`pgrep ffmpeg`</span><br><span class="line">stop=&quot;&quot;</span><br><span class="line">if [ $ffmpeg_status == $stop ]</span><br><span class="line">then</span><br><span class="line">ffmpeg  -rtsp_transport udp -i rtsp://admin:admin123@192.168.1.108:554 -vcodec copy -f segment -segment_time 10  -segment_atclocktime 1 -strftime 1 &quot;/root/camera/video/video%Y-%m-%d_%H-%M-%S.ts&quot;</span><br><span class="line"></span><br><span class="line">else</span><br><span class="line">echo &quot;ffmpeg已启动&quot;</span><br><span class="line">fi</span><br></pre></td></tr></table></figure>


    </div>

    
    
    

      <footer class="post-footer">

        


        
    <div class="post-nav">
      <div class="post-nav-item">
    <a href="/2022/03/28/%E9%9F%B3%E6%9F%B1%E8%B0%83%E8%AF%95/" rel="prev" title="音柱调试">
      <i class="fa fa-chevron-left"></i> 音柱调试
    </a></div>
      <div class="post-nav-item">
    <a href="/2022/03/28/QT/" rel="next" title="QT">
      QT <i class="fa fa-chevron-right"></i>
    </a></div>
    </div>
      </footer>
    
  </article>
  
  
  



          </div>
          

<script>
  window.addEventListener('tabs:register', () => {
    let { activeClass } = CONFIG.comments;
    if (CONFIG.comments.storage) {
      activeClass = localStorage.getItem('comments_active') || activeClass;
    }
    if (activeClass) {
      let activeTab = document.querySelector(`a[href="#comment-${activeClass}"]`);
      if (activeTab) {
        activeTab.click();
      }
    }
  });
  if (CONFIG.comments.storage) {
    window.addEventListener('tabs:click', event => {
      if (!event.target.matches('.tabs-comment .tab-content .tab-pane')) return;
      let commentClass = event.target.classList[1];
      localStorage.setItem('comments_active', commentClass);
    });
  }
</script>

        </div>
          
  
  <div class="toggle sidebar-toggle">
    <span class="toggle-line toggle-line-first"></span>
    <span class="toggle-line toggle-line-middle"></span>
    <span class="toggle-line toggle-line-last"></span>
  </div>

  <aside class="sidebar">
    <div class="sidebar-inner">

      <ul class="sidebar-nav motion-element">
        <li class="sidebar-nav-toc">
          Table of Contents
        </li>
        <li class="sidebar-nav-overview">
          Overview
        </li>
      </ul>

      <!--noindex-->
      <div class="post-toc-wrap sidebar-panel">
          <div class="post-toc motion-element"><ol class="nav"><li class="nav-item nav-level-1"><a class="nav-link" href="#%E5%9F%BA%E6%9C%AC%E9%85%8D%E7%BD%AE"><span class="nav-number">1.</span> <span class="nav-text">基本配置</span></a><ol class="nav-child"><li class="nav-item nav-level-2"><a class="nav-link" href="#%E7%BD%91%E7%BB%9C%E9%85%8D%E7%BD%AE"><span class="nav-number">1.1.</span> <span class="nav-text">网络配置</span></a></li></ol></li><li class="nav-item nav-level-1"><a class="nav-link" href="#Java"><span class="nav-number">2.</span> <span class="nav-text">Java</span></a><ol class="nav-child"><li class="nav-item nav-level-2"><a class="nav-link" href="#bean%E5%8A%A0%E8%BD%BD"><span class="nav-number">2.1.</span> <span class="nav-text">bean加载</span></a></li><li class="nav-item nav-level-2"><a class="nav-link" href="#Python-%E7%8E%AF%E5%A2%83%E5%8F%98%E9%87%8F%E9%85%8D%E7%BD%AE"><span class="nav-number">2.2.</span> <span class="nav-text">Python 环境变量配置</span></a></li><li class="nav-item nav-level-2"><a class="nav-link" href="#RestTemplate%E8%AF%B7%E6%B1%82"><span class="nav-number">2.3.</span> <span class="nav-text">RestTemplate请求</span></a></li><li class="nav-item nav-level-2"><a class="nav-link" href="#RestTemplate-%E7%9A%84%E4%B8%8D%E8%B6%B3"><span class="nav-number">2.4.</span> <span class="nav-text">RestTemplate 的不足</span></a></li><li class="nav-item nav-level-2"><a class="nav-link" href="#%E4%BD%BF%E7%94%A8Httpclient"><span class="nav-number">2.5.</span> <span class="nav-text">使用Httpclient</span></a></li><li class="nav-item nav-level-2"><a class="nav-link" href="#Digest%E8%BF%94%E5%9B%9E%E5%80%BC"><span class="nav-number">2.6.</span> <span class="nav-text">Digest返回值</span></a></li><li class="nav-item nav-level-2"><a class="nav-link" href="#PostConstruct"><span class="nav-number">2.7.</span> <span class="nav-text">@PostConstruct</span></a></li><li class="nav-item nav-level-2"><a class="nav-link" href="#Async"><span class="nav-number">2.8.</span> <span class="nav-text">@Async</span></a></li><li class="nav-item nav-level-2"><a class="nav-link" href="#%E9%9D%99%E6%80%81%E8%B5%84%E6%BA%90%E8%AE%BF%E9%97%AE"><span class="nav-number">2.9.</span> <span class="nav-text">静态资源访问</span></a></li><li class="nav-item nav-level-2"><a class="nav-link" href="#input%E8%8E%B7%E5%8F%96value"><span class="nav-number">2.10.</span> <span class="nav-text">input获取value</span></a></li><li class="nav-item nav-level-2"><a class="nav-link" href="#websocket-endpoint"><span class="nav-number">2.11.</span> <span class="nav-text">websocket endpoint</span></a></li><li class="nav-item nav-level-2"><a class="nav-link" href="#%E4%BB%8E%E9%85%8D%E7%BD%AE%E6%96%87%E4%BB%B6%E8%8E%B7%E5%8F%96%E5%80%BC"><span class="nav-number">2.12.</span> <span class="nav-text">从配置文件获取值</span></a></li><li class="nav-item nav-level-2"><a class="nav-link" href="#jar%E5%8C%85%E8%AE%BF%E9%97%AE%E5%A4%96%E9%83%A8%E9%9D%99%E6%80%81%E8%B5%84%E6%BA%90"><span class="nav-number">2.13.</span> <span class="nav-text">jar包访问外部静态资源</span></a></li><li class="nav-item nav-level-2"><a class="nav-link" href="#Linux%E4%B8%8B%E6%96%87%E4%BB%B6%E6%8E%92%E5%BA%8F%E4%B8%8D%E5%90%8C"><span class="nav-number">2.14.</span> <span class="nav-text">Linux下文件排序不同</span></a></li></ol></li><li class="nav-item nav-level-1"><a class="nav-link" href="#%E6%B5%81%E5%AA%92%E4%BD%93"><span class="nav-number">3.</span> <span class="nav-text">流媒体</span></a><ol class="nav-child"><li class="nav-item nav-level-2"><a class="nav-link" href="#Digest%E8%AE%A4%E8%AF%81"><span class="nav-number">3.1.</span> <span class="nav-text">Digest认证</span></a></li><li class="nav-item nav-level-2"><a class="nav-link" href="#Digest-%E8%AE%A4%E8%AF%81%E7%9A%84Java%E5%AE%9E%E7%8E%B0"><span class="nav-number">3.2.</span> <span class="nav-text">Digest 认证的Java实现</span></a></li><li class="nav-item nav-level-2"><a class="nav-link" href="#rtsp%E8%B4%A6%E5%8F%B7%E5%AF%86%E7%A0%81%E9%AA%8C%E8%AF%81"><span class="nav-number">3.3.</span> <span class="nav-text">rtsp账号密码验证</span></a></li><li class="nav-item nav-level-2"><a class="nav-link" href="#TCP%E4%B8%80%E6%A0%B7%E5%A4%B1%E7%9C%9F"><span class="nav-number">3.4.</span> <span class="nav-text">TCP一样失真</span></a></li><li class="nav-item nav-level-2"><a class="nav-link" href="#buffer%E5%A4%A7%E5%B0%8F%E8%AE%BE%E7%BD%AE"><span class="nav-number">3.5.</span> <span class="nav-text">buffer大小设置</span></a></li><li class="nav-item nav-level-2"><a class="nav-link" href="#flush"><span class="nav-number">3.6.</span> <span class="nav-text">flush</span></a></li><li class="nav-item nav-level-2"><a class="nav-link" href="#flush-%E9%85%8D%E7%BD%AE"><span class="nav-number">3.7.</span> <span class="nav-text">flush 配置</span></a></li><li class="nav-item nav-level-2"><a class="nav-link" href="#%E8%A7%A3%E5%86%B3%E9%97%B4%E9%9A%94%E7%9A%84%E5%8D%A1%E9%A1%BF%E9%97%AE%E9%A2%98"><span class="nav-number">3.8.</span> <span class="nav-text">解决间隔的卡顿问题</span></a></li><li class="nav-item nav-level-2"><a class="nav-link" href="#%E7%A7%BB%E5%8A%A8%E5%A4%B1%E7%9C%9F%E9%97%AE%E9%A2%98"><span class="nav-number">3.9.</span> <span class="nav-text">移动失真问题</span></a></li><li class="nav-item nav-level-2"><a class="nav-link" href="#grabber%E5%92%8Crecorder-%E7%9A%84%E5%8F%82%E6%95%B0%E8%AE%BE%E7%BD%AE"><span class="nav-number">3.10.</span> <span class="nav-text">grabber和recorder 的参数设置</span></a></li><li class="nav-item nav-level-2"><a class="nav-link" href="#%E6%AF%94%E7%89%B9%E7%8E%87"><span class="nav-number">3.11.</span> <span class="nav-text">比特率</span></a></li><li class="nav-item nav-level-2"><a class="nav-link" href="#websocket%E8%AE%BE%E7%BD%AE"><span class="nav-number">3.12.</span> <span class="nav-text">websocket设置</span></a></li><li class="nav-item nav-level-2"><a class="nav-link" href="#%E7%BA%BF%E7%A8%8B%E6%93%8D%E4%BD%9C"><span class="nav-number">3.13.</span> <span class="nav-text">线程操作</span></a></li><li class="nav-item nav-level-2"><a class="nav-link" href="#%E5%BC%82%E6%AD%A5%E6%93%8D%E4%BD%9C"><span class="nav-number">3.14.</span> <span class="nav-text">异步操作</span></a></li><li class="nav-item nav-level-2"><a class="nav-link" href="#%E6%B5%81%E5%AA%92%E4%BD%93%E5%90%8E%E7%AB%AF%E4%BC%A0%E8%BE%93%E8%A7%86%E9%A2%91"><span class="nav-number">3.15.</span> <span class="nav-text">流媒体后端传输视频</span></a></li><li class="nav-item nav-level-2"><a class="nav-link" href="#%E6%B5%81%E5%AA%92%E4%BD%93%E5%89%8D%E7%AB%AF"><span class="nav-number">3.16.</span> <span class="nav-text">流媒体前端</span></a></li><li class="nav-item nav-level-2"><a class="nav-link" href="#%E8%A7%A3%E7%A0%81"><span class="nav-number">3.17.</span> <span class="nav-text">解码</span></a></li><li class="nav-item nav-level-2"><a class="nav-link" href="#%E6%8A%A5%E9%94%99"><span class="nav-number">3.18.</span> <span class="nav-text">报错</span></a></li><li class="nav-item nav-level-2"><a class="nav-link" href="#%E8%A7%86%E9%A2%91%E5%92%8C%E7%9B%B4%E6%92%AD%E8%A7%86%E9%A2%91%E6%B5%81"><span class="nav-number">3.19.</span> <span class="nav-text">视频和直播视频流</span></a></li></ol></li><li class="nav-item nav-level-1"><a class="nav-link" href="#%E4%BA%91%E5%8F%B0%E7%A7%BB%E5%8A%A8"><span class="nav-number">4.</span> <span class="nav-text">云台移动</span></a><ol class="nav-child"><li class="nav-item nav-level-2"><a class="nav-link" href="#up"><span class="nav-number">4.1.</span> <span class="nav-text">up</span></a></li></ol></li><li class="nav-item nav-level-1"><a class="nav-link" href="#%E4%BA%91%E5%8F%B0%E5%8F%98%E7%84%A6"><span class="nav-number">5.</span> <span class="nav-text">云台变焦</span></a></li><li class="nav-item nav-level-1"><a class="nav-link" href="#%E4%BA%91%E9%83%A8%E7%BD%B2"><span class="nav-number">6.</span> <span class="nav-text">云部署</span></a><ol class="nav-child"><li class="nav-item nav-level-2"><a class="nav-link" href="#%E5%86%85%E7%BD%91%E7%9A%84%E6%9C%BA%E5%99%A8"><span class="nav-number">6.1.</span> <span class="nav-text">内网的机器</span></a></li><li class="nav-item nav-level-2"><a class="nav-link" href="#%E5%85%AC%E7%BD%91IP"><span class="nav-number">6.2.</span> <span class="nav-text">公网IP</span></a></li><li class="nav-item nav-level-2"><a class="nav-link" href="#%E5%86%85%E7%BD%91%E7%A9%BF%E9%80%8F"><span class="nav-number">6.3.</span> <span class="nav-text">内网穿透</span></a></li><li class="nav-item nav-level-2"><a class="nav-link" href="#DDNS"><span class="nav-number">6.4.</span> <span class="nav-text">DDNS</span></a></li></ol></li><li class="nav-item nav-level-1"><a class="nav-link" href="#%E9%9C%80%E6%B1%82"><span class="nav-number">7.</span> <span class="nav-text">需求</span></a></li><li class="nav-item nav-level-1"><a class="nav-link" href="#JavaCV"><span class="nav-number">8.</span> <span class="nav-text">JavaCV</span></a><ol class="nav-child"><li class="nav-item nav-level-2"><a class="nav-link" href="#recorder-stop"><span class="nav-number">8.1.</span> <span class="nav-text">recorder.stop()</span></a></li><li class="nav-item nav-level-2"><a class="nav-link" href="#pixel-format"><span class="nav-number">8.2.</span> <span class="nav-text">pixel format</span></a></li><li class="nav-item nav-level-2"><a class="nav-link" href="#JavaCV%E5%A4%AA%E5%A4%A7"><span class="nav-number">8.3.</span> <span class="nav-text">JavaCV太大</span></a></li></ol></li><li class="nav-item nav-level-1"><a class="nav-link" href="#%E7%9B%91%E6%8E%A7%E5%AD%98%E5%82%A8"><span class="nav-number">9.</span> <span class="nav-text">监控存储</span></a><ol class="nav-child"><li class="nav-item nav-level-2"><a class="nav-link" href="#%E8%A7%A3%E5%86%B3%E6%96%B9%E6%A1%88"><span class="nav-number">9.1.</span> <span class="nav-text">解决方案</span></a><ol class="nav-child"><li class="nav-item nav-level-3"><a class="nav-link" href="#NVR"><span class="nav-number">9.1.1.</span> <span class="nav-text">NVR</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#IP-SAN"><span class="nav-number">9.1.2.</span> <span class="nav-text">IP-SAN</span></a></li></ol></li><li class="nav-item nav-level-2"><a class="nav-link" href="#HLS"><span class="nav-number">9.2.</span> <span class="nav-text">HLS</span></a></li><li class="nav-item nav-level-2"><a class="nav-link" href="#ffmpeg%E6%80%8E%E4%B9%88%E8%AF%BB"><span class="nav-number">9.3.</span> <span class="nav-text">ffmpeg怎么读</span></a></li><li class="nav-item nav-level-2"><a class="nav-link" href="#ffmpeg-rtsp%E4%BF%9D%E5%AD%98%E4%B8%BAts"><span class="nav-number">9.4.</span> <span class="nav-text">ffmpeg rtsp保存为ts</span></a></li><li class="nav-item nav-level-2"><a class="nav-link" href="#ffmpeg%E8%A7%86%E9%A2%91%E6%97%B6%E9%95%BF"><span class="nav-number">9.5.</span> <span class="nav-text">ffmpeg视频时长</span></a></li><li class="nav-item nav-level-2"><a class="nav-link" href="#%E8%A7%86%E9%A2%91%E6%97%B6%E9%97%B4%E4%B8%8D%E5%AF%B9"><span class="nav-number">9.6.</span> <span class="nav-text">视频时间不对</span></a></li><li class="nav-item nav-level-2"><a class="nav-link" href="#ffmpeg%E5%88%86%E7%89%87"><span class="nav-number">9.7.</span> <span class="nav-text">ffmpeg分片</span></a></li><li class="nav-item nav-level-2"><a class="nav-link" href="#m3u8"><span class="nav-number">9.8.</span> <span class="nav-text">m3u8</span></a></li><li class="nav-item nav-level-2"><a class="nav-link" href="#m3u8%E5%89%8D%E7%AB%AF"><span class="nav-number">9.9.</span> <span class="nav-text">m3u8前端</span></a></li></ol></li><li class="nav-item nav-level-1"><a class="nav-link" href="#%E8%A7%86%E9%A2%91%E7%BC%96%E7%A0%81"><span class="nav-number">10.</span> <span class="nav-text">视频编码</span></a><ol class="nav-child"><li class="nav-item nav-level-2"><a class="nav-link" href="#%E4%B8%BA%E4%BB%80%E4%B9%88"><span class="nav-number">10.1.</span> <span class="nav-text">为什么</span></a></li><li class="nav-item nav-level-2"><a class="nav-link" href="#%E5%B0%81%E8%A3%85%E6%A0%BC%E5%BC%8F"><span class="nav-number">10.2.</span> <span class="nav-text">封装格式</span></a></li><li class="nav-item nav-level-2"><a class="nav-link" href="#%E7%BC%96%E7%A0%81%E6%A0%BC%E5%BC%8F"><span class="nav-number">10.3.</span> <span class="nav-text">编码格式</span></a></li><li class="nav-item nav-level-2"><a class="nav-link" href="#%E7%A0%81%E7%8E%87"><span class="nav-number">10.4.</span> <span class="nav-text">码率</span></a></li><li class="nav-item nav-level-2"><a class="nav-link" href="#%E8%A7%86%E9%A2%91%E5%8E%8B%E7%BC%A9"><span class="nav-number">10.5.</span> <span class="nav-text">视频压缩</span></a></li><li class="nav-item nav-level-2"><a class="nav-link" href="#GOP"><span class="nav-number">10.6.</span> <span class="nav-text">GOP</span></a></li><li class="nav-item nav-level-2"><a class="nav-link" href="#CBR"><span class="nav-number">10.7.</span> <span class="nav-text">CBR</span></a></li><li class="nav-item nav-level-2"><a class="nav-link" href="#VBR"><span class="nav-number">10.8.</span> <span class="nav-text">VBR</span></a></li><li class="nav-item nav-level-2"><a class="nav-link" href="#CRF"><span class="nav-number">10.9.</span> <span class="nav-text">CRF</span></a></li><li class="nav-item nav-level-2"><a class="nav-link" href="#%E7%BC%96%E7%A0%81%E5%99%A8"><span class="nav-number">10.10.</span> <span class="nav-text">编码器</span></a></li><li class="nav-item nav-level-2"><a class="nav-link" href="#MPEG-PS"><span class="nav-number">10.11.</span> <span class="nav-text">MPEG-PS</span></a></li></ol></li><li class="nav-item nav-level-1"><a class="nav-link" href="#Git"><span class="nav-number">11.</span> <span class="nav-text">Git</span></a><ol class="nav-child"><li class="nav-item nav-level-2"><a class="nav-link" href="#%E6%96%B0%E5%88%86%E6%94%AF"><span class="nav-number">11.1.</span> <span class="nav-text">新分支</span></a></li></ol></li><li class="nav-item nav-level-1"><a class="nav-link" href="#SDK"><span class="nav-number">12.</span> <span class="nav-text">SDK</span></a><ol class="nav-child"><li class="nav-item nav-level-2"><a class="nav-link" href="#%E5%8F%A5%E6%9F%84"><span class="nav-number">12.1.</span> <span class="nav-text">句柄</span></a></li></ol></li><li class="nav-item nav-level-1"><a class="nav-link" href="#Intellij"><span class="nav-number">13.</span> <span class="nav-text">Intellij</span></a><ol class="nav-child"><li class="nav-item nav-level-2"><a class="nav-link" href="#intellij-%E5%AD%90%E6%A8%A1%E5%9D%97%EF%BC%88%E5%BE%85%E8%A1%A5%E5%85%85%EF%BC%89"><span class="nav-number">13.1.</span> <span class="nav-text">intellij 子模块（待补充）</span></a></li><li class="nav-item nav-level-2"><a class="nav-link" href="#intellij-%E5%AF%BC%E5%85%A5%E5%85%B6%E4%BB%96%E5%AD%90%E6%A8%A1%E5%9D%97%E7%9A%84%E5%B7%A5%E5%85%B7%E7%B1%BB"><span class="nav-number">13.2.</span> <span class="nav-text">intellij 导入其他子模块的工具类</span></a></li></ol></li><li class="nav-item nav-level-1"><a class="nav-link" href="#%E8%84%9A%E6%9C%AC"><span class="nav-number">14.</span> <span class="nav-text">脚本</span></a><ol class="nav-child"><li class="nav-item nav-level-2"><a class="nav-link" href="#%E5%AE%9A%E6%97%B6%E4%BB%BB%E5%8A%A1"><span class="nav-number">14.1.</span> <span class="nav-text">定时任务</span></a></li><li class="nav-item nav-level-2"><a class="nav-link" href="#%E5%AE%9A%E6%97%B6%E6%B8%85%E7%90%86%E5%BD%95%E5%83%8F%E5%92%8Cm3u8"><span class="nav-number">14.2.</span> <span class="nav-text">定时清理录像和m3u8</span></a></li><li class="nav-item nav-level-2"><a class="nav-link" href="#%E5%90%AF%E5%8A%A8ffmpeg%E6%8E%A8%E6%B5%81"><span class="nav-number">14.3.</span> <span class="nav-text">启动ffmpeg推流</span></a></li></ol></li></ol></div>
      </div>
      <!--/noindex-->

      <div class="site-overview-wrap sidebar-panel">
        <div class="site-author motion-element" itemprop="author" itemscope itemtype="http://schema.org/Person">
    <img class="site-author-image" itemprop="image" alt="FreeJim"
      src="/images/avatar.jpg">
  <p class="site-author-name" itemprop="name">FreeJim</p>
  <div class="site-description" itemprop="description">Hello World</div>
</div>
<div class="site-state-wrap motion-element">
  <nav class="site-state">
      <div class="site-state-item site-state-posts">
          <a href="/archives/">
        
          <span class="site-state-item-count">299</span>
          <span class="site-state-item-name">posts</span>
        </a>
      </div>
      <div class="site-state-item site-state-categories">
        <span class="site-state-item-count">31</span>
        <span class="site-state-item-name">categories</span>
      </div>
      <div class="site-state-item site-state-tags">
        <span class="site-state-item-count">23</span>
        <span class="site-state-item-name">tags</span>
      </div>
  </nav>
</div>



      </div>

    </div>
  </aside>
  <div id="sidebar-dimmer"></div>


      </div>
    </main>

    <footer class="footer">
      <div class="footer-inner">
        

        

<div class="copyright">
  
  &copy; 
  <span itemprop="copyrightYear">2023</span>
  <span class="with-love">
    <i class="fa fa-heart"></i>
  </span>
  <span class="author" itemprop="copyrightHolder">FreeJim</span>
</div>
  <div class="powered-by">Powered by <a href="https://hexo.io/" class="theme-link" rel="noopener" target="_blank">Hexo</a> & <a href="https://muse.theme-next.org/" class="theme-link" rel="noopener" target="_blank">NexT.Muse</a>
  </div>

        








      </div>
    </footer>
  </div>

  
  <script src="/lib/anime.min.js"></script>
  <script src="/lib/velocity/velocity.min.js"></script>
  <script src="/lib/velocity/velocity.ui.min.js"></script>

<script src="/js/utils.js"></script>

<script src="/js/motion.js"></script>


<script src="/js/schemes/muse.js"></script>


<script src="/js/next-boot.js"></script>




  




  
<script src="/js/local-search.js"></script>













  

  

  

  <script type="text/javascript" src="//cdn.bootcss.com/canvas-nest.js/1.0.1/canvas-nest.min.js"></script>
<script src="/live2dw/lib/L2Dwidget.min.js?094cbace49a39548bed64abff5988b05"></script><script>L2Dwidget.init({"model":{"scale":1,"hHeadPos":0.5,"vHeadPos":0.618,"jsonPath":"/live2dw/assets/miku.model.json"},"display":{"superSample":2,"width":150,"height":300,"position":"right","hOffset":0,"vOffset":-20},"mobile":{"show":true,"scale":0.5},"react":{"opacityDefault":0.7,"opacityOnHover":0.2},"log":false,"pluginJsPath":"lib/","pluginModelPath":"assets/","pluginRootPath":"live2dw/","tagMode":false});</script></body>
</html>
